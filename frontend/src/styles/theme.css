/* ==============================================
   THEME UTILITIES - Light & Dark Mode
   ============================================== */

/* 
 * This file provides easy-to-use utility classes for theming.
 * Import this file in your globals.css or layout.
 * See THEME_README.md for usage instructions.
 */

/* ==============================================
   COLOR VARIABLES
   ============================================== */
:root {
  /* Purple palette */
  --theme-purple: #663265;
  --theme-purple-light: #e079d4;
  --theme-purple-lighter: #f7e5f5;
  --theme-purple-dark: #471e3b;
  --theme-purple-darker: #ca70be;

  /* White/Light colors */
  --theme-white: #ffffff;
  --theme-white-soft: #faf7fb;
  --theme-white-muted: #f0ebf0;

  /* Text colors - Light mode */
  --theme-text: #663265;
  --theme-text-muted: #6f5772;
  --theme-text-light: #8a7a8c;

  /* Gradient colors */
  --theme-gradient-start: #a16ca1;
  --theme-gradient-end: #c47bbb;
  --theme-gradient-light-start: #a4539b;
  --theme-gradient-light-end: #d4add0;
  --theme-gradient-dark-start: #471e3b;
  --theme-gradient-dark-end: #663265;
  /* Sticker owner highlight color - used for markers that belong to the current logged-in user */
  --sticker-mine: #2563eb; /* blue-600 */
  --sticker-mine-light: #60a5fa; /* blue-400 for light accents */
}

/* Dark mode overrides */
.dark {
  /* Text colors - Dark mode */
  --theme-text: #ffffff;
  --theme-text-muted: #c9b2cc;
  --theme-text-light: #e0d5e1;

  /* Adjusted purples for dark mode visibility */
  --theme-purple: #d9a3d6;
  --theme-purple-light: #e8c4e6;
  --theme-purple-lighter: #f4e2f3;
  --theme-purple-dark: #b471ad;
  --theme-purple-darker: #663265;

  /* White stays white in dark mode */
  --theme-white: #ffffff;
  --theme-white-soft: #f5f0f5;
  --theme-white-muted: #e8e0e8;

  /* Gradient colors for dark mode */
  --theme-gradient-start: #663265;
  --theme-gradient-end: #a4539b;
  --theme-gradient-light-start: #a4539b;
  --theme-gradient-light-end: #d4add0;
  --theme-gradient-dark-start: #471e3b;
  --theme-gradient-dark-end: #663265;
  /* Dark mode override for sticker owner color */
  --sticker-mine: #60a5fa; /* lighter blue on dark bg */
  --sticker-mine-light: #93c5fd;
}

/* ==============================================
   GLOBAL TEXT COLOR APPLICATION
   ============================================== */

/* Apply theme colors globally to all elements */
*, *::before, *::after {
  color: inherit;
}

/* Base text color for all elements */
html, body {
  color: var(--theme-text);
}

/* Ensure all common text elements use theme colors */
h1, h2, h3, h4, h5, h6,
p, span, a, li, label,
div, section, article, aside,
header, footer, nav, main,
button, input, textarea, select,
td, th, caption,
blockquote, cite, figcaption {
  color: inherit;
}

/* Links - slightly different for visibility */
a {
  color: var(--theme-purple);
}

a:hover {
  color: var(--theme-purple-light);
}

/* Form elements */
input, textarea, select {
  color: var(--theme-text);
  background-color: inherit;
}

/* Darker form inputs in dark mode */
.dark input, .dark textarea, .dark select {
  background-color: rgba(0, 0, 0, 0.3);
}

input::placeholder, textarea::placeholder {
  color: var(--theme-text-muted);
}

/* ==============================================
   TEXT COLOR UTILITIES
   ============================================== */

/* Adaptive text (changes with theme) */
.text-theme {
  color: var(--theme-text) !important;
}

.text-theme-muted {
  color: var(--theme-text-muted) !important;
}

.text-theme-light {
  color: var(--theme-text-light) !important;
}

/* White text (always white) */
.text-theme-white {
  color: var(--theme-white) !important;
}

/* Purple text variations */
.text-theme-purple {
  color: var(--theme-purple) !important;
}

.text-theme-purple-light {
  color: var(--theme-purple-light) !important;
}

.text-theme-purple-lighter {
  color: var(--theme-purple-lighter) !important;
}
.text-theme-purple-dark {
  color: var(--theme-purple-dark) !important;
}

.text-theme-purple-darker {
  color: var(--theme-purple-darker) !important;
}

/* ==============================================
   GRADIENT TEXT UTILITIES
   ============================================== */

/* Base gradient text setup */
.text-gradient {
  background: linear-gradient(
    135deg,
    var(--theme-gradient-start),
    var(--theme-gradient-end)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Light gradient */
.text-gradient-light {
  background: linear-gradient(
    135deg,
    var(--theme-gradient-light-start),
    var(--theme-gradient-light-end)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Horizontal gradient */
.text-gradient-horizontal {
  background: linear-gradient(
    90deg,
    var(--theme-gradient-start),
    var(--theme-gradient-end)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Vertical gradient */
.text-gradient-vertical {
  background: linear-gradient(
    180deg,
    var(--theme-gradient-start),
    var(--theme-gradient-end)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Purple to white gradient (great for dark backgrounds) */
.text-gradient-purple-white {
  background: linear-gradient(135deg, var(--theme-purple), var(--theme-white));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* White to purple gradient */
.text-gradient-white-purple {
  background: linear-gradient(135deg, var(--theme-white), var(--theme-purple));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Animated gradient */
.text-gradient-animated {
  background: linear-gradient(
    135deg,
    var(--theme-gradient-start),
    var(--theme-gradient-end),
    var(--theme-gradient-start)
  );
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradientShift 3s ease infinite;
}

@keyframes gradientShift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* ==============================================
   BACKGROUND UTILITIES
   ============================================== */

.bg-theme-purple {
  background-color: var(--theme-purple);
}

.bg-theme-purple-light {
  background-color: var(--theme-purple-light);
}

.bg-theme-purple-lighter {
  background-color: var(--theme-purple-lighter);
}

.bg-theme-purple-dark {
  background-color: var(--theme-purple-dark);
}

.bg-theme-purple-darker {
  background-color: var(--theme-purple-darker);
}

.bg-gradient-theme {
  background: linear-gradient(
    135deg,
    var(--theme-gradient-start),
    var(--theme-gradient-end)
  );
}

.bg-gradient-theme-horizontal {
  background: linear-gradient(
    90deg,
    var(--theme-gradient-start),
    var(--theme-gradient-end)
  );
}

.bg-gradient-theme-vertical {
  background: linear-gradient(
    180deg,
    var(--theme-gradient-start),
    var(--theme-gradient-end)
  );
}

/* Full page gradient (purple to dark purple to purple) */
.bg-gradient-theme-page {
  background: linear-gradient(
    to bottom right,
    var(--theme-purple),
    var(--theme-purple-dark),
    var(--theme-purple)
  );
}

/* Alternative page gradient with more contrast */
.bg-gradient-theme-page-alt {
  background: linear-gradient(
    to bottom right,
    var(--theme-purple),
    var(--theme-purple-darker),
    var(--theme-purple-dark)
  );
}

/* ==============================================
   BORDER UTILITIES
   ============================================== */

.border-theme-purple {
  border-color: var(--theme-purple);
}

.border-theme-purple-light {
  border-color: var(--theme-purple-light);
}

.border-theme-purple-dark {
  border-color: var(--theme-purple-dark);
}

/* ==============================================
   HOVER STATES
   ============================================== */

.hover\:text-theme-purple:hover {
  color: var(--theme-purple);
}

.hover\:text-theme-purple-light:hover {
  color: var(--theme-purple-light);
}

.hover\:text-theme-purple-dark:hover {
  color: var(--theme-purple-dark);
}

.hover\:bg-theme-purple:hover {
  background-color: var(--theme-purple);
}

.hover\:bg-theme-purple-light:hover {
  background-color: var(--theme-purple-light);
}

.hover\:bg-theme-purple-dark:hover {
  background-color: var(--theme-purple-dark);
}

/* ==============================================
   FOCUS STATES
   ============================================== */

.focus\:ring-theme-purple:focus {
  --tw-ring-color: var(--theme-purple);
}

.focus\:border-theme-purple:focus {
  border-color: var(--theme-purple);
}

/* ==============================================
   ICON ANIMATIONS
   ============================================== */

.icon-animated {
  transform-origin: center center;
  display: inline-block;
}

/* ==============================================
   BUTTON HELPERS
   ============================================== */

/* Add-sticker specific helper: in light mode make the button purple (solid) instead of orange->purple gradient
   so it reads well on white backgrounds. In dark mode keep the gradient so it still matches the theme. */
.btn-add-sticker {
  /* fallback - keep existing gradient if available */
  background-image: linear-gradient(90deg, var(--theme-gradient-light-start), var(--theme-gradient-light-end));
  color: var(--theme-white);
}

/* Light mode override: prefer a solid purple button for better contrast on white */
html:not(.dark) .btn-add-sticker {
  background: var(--theme-purple);
  box-shadow: 0 10px 30px rgba(102,50,101,0.12);
  border: 1px solid rgba(102,50,101,0.08);
}

/* Dark mode: keep the gradient look (no change) */
html.dark .btn-add-sticker {
  background: linear-gradient(90deg, var(--theme-gradient-start), var(--theme-gradient-end));
}

@keyframes icon-rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes icon-float {
  0% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
  100% { transform: translateY(0); }
}

@keyframes icon-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.08); }
  100% { transform: scale(1); }
}

/* Map popup and control theme overrides for MapLibre/Mapbox popup elements */
/* Light mode popup */
.mapboxgl-popup-content {
  background: #ffffff !important;
  color: #663265 !important;
  border-radius: 0.5rem;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

/* Dark mode popup - when html has dark class */
html.dark .mapboxgl-popup-content {
  background: #1f1921 !important;
  color: #ffffff !important;
}

.mapboxgl-popup-tip {
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

/* Map controls sizing and background */
.mapboxgl-ctrl, .mapboxgl-ctrl-top-right {
  background: transparent !important;
}

/* Ensure popup text inherits parent color */
.mapboxgl-popup-content * {
  color: inherit !important;
}

/* Force high-specificity overrides for popup inner content injected into body */
html.dark .mapboxgl-popup-content,
html.dark .mapboxgl-popup-content * {
  background: #1f1921 !important;
  color: #ffffff !important;
}

html:not(.dark) .mapboxgl-popup-content,
html:not(.dark) .mapboxgl-popup-content * {
  background: #ffffff !important;
  color: #663265 !important;
}

/* Dark mode: make map popups dark and readable */
html.dark .mapboxgl-popup-content,
html.dark .mapboxgl-popup-content *,
html.dark .map-popup-theme .map-popup,
html.dark .map-popup-theme .map-popup * {
  background: var(--bg-card) !important;
  color: var(--text-main) !important;
}

html.dark .mapboxgl-popup-tip {
  /* tip color */
  background: var(--bg-card) !important;
}

/* Hide the outer tip/arrow entirely in dark mode to avoid visible white edges */
html.dark .mapboxgl-popup-tip {
  display: none !important;
}

/* Mapbox uses anchor wrappers that may have background - clear them */
html.dark .mapboxgl-popup-anchor-top,
html.dark .mapboxgl-popup-anchor-bottom,
html.dark .mapboxgl-popup-anchor-left,
html.dark .mapboxgl-popup-anchor-right {
  background: transparent !important;
  padding: 0 !important;
}

/* Final ensure: collapse any white frame by forcing the outer popup to be fully transparent */
html.dark .mapboxgl-popup {
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
}

/* Aggressive overrides to remove any white border/stroke around popups in dark mode */
html.dark .mapboxgl-popup,
html.dark .mapboxgl-popup-content,
html.dark .mapboxgl-popup-tip,
html.dark .mapboxgl-popup-content *,
html.dark .mapboxgl-popup * {
  border: none !important;
  outline: none !important;
  box-shadow: 0 12px 34px rgba(0,0,0,0.6) !important;
  background-clip: padding-box !important;
}

/* Some map libraries draw an SVG tip/arrow with stroke - clear strokes */
html.dark .mapboxgl-popup-tip svg,
html.dark .mapboxgl-popup-tip path,
html.dark .mapboxgl-popup-tip polygon {
  stroke: none !important;
  fill: var(--bg-card) !important;
}

/* Make outer popup container transparent so inner .map-popup card is the visible surface */
html.dark .mapboxgl-popup {
  background: transparent !important;
  padding: 0 !important;
}

/* The content wrapper often adds padding/background - clear it */
html.dark .mapboxgl-popup-content {
  background: transparent !important;
  padding: 0 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
}

/* Ensure the inner custom card (.map-popup) is visible and styled */
html.dark .map-popup-theme .map-popup {
  background: var(--bg-card) !important;
  padding: 12px !important;
  border-radius: 0.5rem !important;
  box-shadow: 0 12px 34px rgba(0,0,0,0.6) !important;
}

/* Remove thick white border in dark mode, use subtle translucent border and deeper shadow */
html.dark .mapboxgl-popup-content {
  border: 1px solid rgba(255,255,255,0.04) !important;
  box-shadow: 0 12px 34px rgba(0,0,0,0.6) !important;
}

/* Avatar border: avoid strong white border in dark mode */
html.dark .map-popup__avatar {
  border: 2px solid rgba(255,255,255,0.06) !important;
}

/* Close button styling */
.mapboxgl-popup-close-button {
  color: #663265 !important;
  font-size: 24px;
  padding: 0 8px;
}

html.dark .mapboxgl-popup-close-button {
  color: #ffffff !important;
}

.mapboxgl-popup-close-button:hover {
  background-color: rgba(128, 128, 128, 0.2);
}

/* Marker styling for sticker map */
.samu-marker {
  width: 48px;
  height: 48px;
  position: relative;
  border-radius: 9999px;
  overflow: visible;
  display: inline-block;
  transform-origin: center;
}
.samu-marker__img {
  width: 48px;
  height: 48px;
  border-radius: 9999px;
  object-fit: cover;
  border: 3px solid var(--theme-white);
  box-shadow: 0 6px 12px rgba(0,0,0,0.25);
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}
.samu-marker:hover .samu-marker__img { transform: scale(1.12); }
.samu-marker__dot {
  position: absolute;
  bottom: -4px;
  right: -4px;
  width: 14px;
  height: 14px;
  border-radius: 9999px;
  border: 2px solid var(--theme-white);
  background: var(--color-primary-200);
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.samu-marker__dot--mine { background: var(--sticker-mine); }
.samu-marker--mine .samu-marker__img { box-shadow: 0 10px 22px rgba(37,99,235,0.22); }
.samu-marker--selected { width:48px; height:48px; display:flex; align-items:center; justify-content:center; border-radius:9999px; background:var(--color-primary-500); color:white; border:3px solid var(--theme-white); }

/* Popup content layout */
.map-popup { display:block; max-width:320px; }
.map-popup__head { display:flex; gap:0.75rem; align-items:center; margin-bottom:0.5rem; }
.map-popup__avatar { width:40px; height:40px; border-radius:9999px; object-fit:cover; border:2px solid var(--theme-white); }
html.dark .map-popup__avatar { border:2px solid rgba(255,255,255,0.06) !important; }

/* Light mode popup text */
.map-popup__title { font-weight:700; color:#663265; }
.map-popup__meta { font-size:0.875rem; color:#6f5772; }
.map-popup__desc { margin-top:0.5rem; color:#663265; }
.map-popup__footer { margin-top:0.5rem; display:flex; gap:0.75rem; flex-direction:column; }
.map-popup__footer > div { color:#6f5772; }

/* Dark mode popup text */
html.dark .map-popup__title { color:#ffffff !important; }
html.dark .map-popup__meta { color:#c9b2cc !important; }
html.dark .map-popup__desc { color:#ffffff !important; }
html.dark .map-popup__footer > div { color:#c9b2cc !important; }


/* Animate icons continuously */
.icon-animate-rotate {
  animation: icon-rotate 2000ms linear infinite;
}

.icon-animate-float {
  animation: icon-float 2000ms ease-in-out infinite;
}

.icon-animate-pulse {
  animation: icon-pulse 2000ms ease-in-out infinite;
}

/* Speed up animation slightly on hover */
.group:hover .icon-animate-rotate {
  animation-duration: 900ms;
}

.group:hover .icon-animate-float {
  animation-duration: 900ms;
}

.group:hover .icon-animate-pulse {
  animation-duration: 900ms;
}

.group:hover .icon-animated { /* subtle smoothness */
  transition: transform 200ms ease;
}
