services:
  frontend:
    image: ghcr.io/salvemundi/frontend:${TAG}
    container_name: frontend-${TAG:-dev}
    restart: unless-stopped
    environment:
      # Server-side environment variable for email API endpoint
      - EMAIL_API_ENDPOINT=${EMAIL_API_ENDPOINT:-http://email-api-${TAG:-dev}:3001/send-email}
      # Publish payment API URL for client-side usage and server-side proxy
      - NEXT_PUBLIC_PAYMENT_API_URL=${NEXT_PUBLIC_PAYMENT_API_URL:-http://payment-api-${TAG:-dev}:3002}
      # Admin API URL for server-side proxy
      - ADMIN_API_URL=${ADMIN_API_URL:-http://admin-api-dev:3005}
      # Public notification API URL - used by both client and server
      # All environments (dev, preprod, prod) use the same centralized notification service
      - NEXT_PUBLIC_NOTIFICATION_API_URL=${NEXT_PUBLIC_NOTIFICATION_API_URL:-https://notifications.salvemundi.nl}
      - INTERNAL_API_KEY=${INTERNAL_API_KEY}
      # Membership API URL for server-side communication with membership-api
      - MEMBERSHIP_API_URL=${MEMBERSHIP_API_URL:-http://membership-api-${TAG:-dev}:8000/api/membership}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
      # Required for server-side API calls (e.g. public-sponsors) and proxy bypass
      # We map the specific secret to the generic token expected by the app
      - DIRECTUS_API_TOKEN=${DIRECTUS_FRONTEND_FRONTEND_TOKEN}
      - DIRECTUS_FRONTEND_FRONTEND_TOKEN=${DIRECTUS_FRONTEND_FRONTEND_TOKEN}
    networks:
      - proxy-network

networks:
  proxy-network:
    external: true